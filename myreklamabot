import os
from pyrogram import Client
from apscheduler.schedulers.asyncio import AsyncIOScheduler
from flask import Flask
from threading import Thread

API_ID = int(os.getenv("API_ID"))
API_HASH = os.getenv("API_HASH")

TARGET_CHATS = [
    -1001572916927, -1001534022169, -1002370663987
]

AD_TEXT = """üá™üá∫–ê—Å—Å–∞–ª–æ–º–∞–ª–µ–∫—É–º üá™üá∫
–í—Å–µ–º –ø—Ä–∏–≤–µ—Çüëã
–£ –Ω–∞—Å –µ—Å—Ç—å –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ
–ü–æ—á—Ç–∞ ‚úâÔ∏è 
–î–æ—Å—Ç–∞–≤–∫–∞ üì¶

–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏
–¢–µ–ª–µ–≥—Ä–∞–º +79630871841
WhatsApp +79630871841
"""

app = Client("userbot_session", api_id=API_ID, api_hash=API_HASH)
scheduler = AsyncIOScheduler()

async def send_ads():
    for chat_id in TARGET_CHATS:
        try:
            await app.send_message(chat_id, AD_TEXT)
            print(f"‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {chat_id}")
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")

@app.on_client_start
async def start_scheduler(client):
    scheduler.add_job(send_ads, "interval", hours=4)
    scheduler.start()
    print("‚úÖ Userbot –∑–∞–ø—É—â–µ–Ω")

flask_app = Flask('')

@flask_app.route('/')
def home():
    return "Userbot —Ä–∞–±–æ—Ç–∞–µ—Ç!"

def run():
    flask_app.run(host='0.0.0.0', port=int(os.getenv("PORT", 8080)))

def keep_alive():
    Thread(target=run).start()

if name == "__main__":
    keep_alive()
    app.run()
